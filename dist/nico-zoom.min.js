!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.NZoom=n()}(this,function(){"use strict";!function(t,n){void 0===n&&(n={});var o=n.insertAt;if(t&&"undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".image-zoom {\n  overflow: visible !important;\n}\n.image-zoom-container {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.image-zoom-content {\n  position: relative;\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n  -webkit-transition: -webkit-transform 300ms cubic-bezier(0.2, 0, 0.2, 1);\n  transition: -webkit-transform 300ms cubic-bezier(0.2, 0, 0.2, 1);\n  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1);\n  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1), -webkit-transform 300ms cubic-bezier(0.2, 0, 0.2, 1);\n  will-change: transform;\n}\n.image-zoom-target {\n  cursor: pointer;\n  cursor: -webkit-zoom-in;\n  cursor: zoom-in;\n}\n\n.image-zoom-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  z-index: -1;\n  cursor: pointer;\n  cursor: -webkit-zoom-out;\n  cursor: zoom-out;\n  opacity: 0;\n  visibility: hidden;\n  -webkit-transition: opacity 0.3s linear, visibility 0s linear;\n  transition: opacity 0.3s linear, visibility 0s linear;\n  will-change: opacity;\n}\n.image-zoom--open .image-zoom-overlay {\n  visibility: visible;\n  opacity: 1;\n  z-index: 9999;\n  cursor: pointer;\n  cursor: -webkit-zoom-out;\n  cursor: zoom-out;\n}\n\n.image-zoom--open .image-zoom-container.open .image-zoom-content {\n  z-index: 10000;\n  cursor: pointer;\n  cursor: -webkit-zoom-out;\n  cursor: zoom-out;\n}\n\n.image-zoom--open .image-zoom-container.open .image-zoom-target {\n  cursor: pointer;\n  cursor: -webkit-zoom-out;\n  cursor: zoom-out;\n}\n");var o={items:"",gutter:20,scrollOffset:10,overlayBg:"#ffffff",scaleFactor:1,beforeZoomIn:function(){},afterZoomIn:function(){},beforeZoomOut:function(){},afterZoomOut:function(){}};function i(){var t=navigator.userAgent;return/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/gi.test(t)}function e(){return Math.max(window.pageYOffset||0,document.documentElement.scrollTop)}function z(t){var n,o,e,i,s,r,a=t.w,c=t.h,h=t.nw,m=t.nh,d=t.gutter,u=(o=(n={width:h,height:m,gutter:d}).width,e=n.height,i=n.gutter,s=window.innerWidth/(o+2*i),r=window.innerHeight/(e+2*i),Math.min(s,r)),l=m<h?h/a:m/c;return 1<u?l:l*u}function s(t,n){var o=document.createElement(t);return n&&o.classList.add(n),o}return function(){function t(t,n){this.setOptions(n),this.container=t,this.isAnimating=!1,this._handleClick=this._handleClick.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.onScroll=this.onScroll.bind(this),this.onResize=this.onResize.bind(this),this._bindEvents=this._bindEvents.bind(this),this._unbindEvents=this._unbindEvents.bind(this),this._destroyZoomer=this._destroyZoomer.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this._createZoomOverlay(),this._init()}var n=t.prototype;return n.setOptions=function(t){this.options=Object.assign({},o,t)},n.refreshElements=function(){this.elements=this.container.querySelectorAll(this.options.items),this._createContainerOfElements()},n._init=function(){if(!this.options.items)throw new Error("no items set!");this.elements=this.container.querySelectorAll(this.options.items),this._createContainerOfElements(),this._bindClickDelegateToContainer()},n._createZoomOverlay=function(){var t=this.options.overlayBg;this._overlay=s("div","image-zoom-overlay"),this._overlay.style.backgroundColor=t,document.body.appendChild(this._overlay)},n._createContainerOfElements=function(){this.elements.forEach(function(t){!function(t){var n=t.parentNode;t.classList.add("image-zoom-target");var o=s("div","image-zoom-container"),e=s("div","image-zoom-content");o.appendChild(e),e.appendChild(t),n.appendChild(o)}(t)})},n.onTouchStart=function(t){this.yTouchPosition=t.touches[0].clientY},n.onTouchMove=function(t){this.options.scrollOffset;if(this.yTouchPosition){Math.abs(t.touches[0].clientY-this.yTouchPosition);this.isAnimating||this.zoomOut()}},n.onTouchEnd=function(){this.yTouchPosition=null},n._bindTouchEvents=function(){window.addEventListener("ontouchstart",this.onTouchStart,!1),window.addEventListener("ontouchmove",this.onTouchMove,!1),window.addEventListener("ontouchend",this.onTouchEnd,!1),window.addEventListener("ontouchcancel",this.onTouchEnd,!1)},n._unbindTouchEvents=function(){window.removeEventListener("ontouchstart",this.onTouchStart,!1),window.removeEventListener("ontouchmove",this.onTouchMove,!1),window.removeEventListener("ontouchend",this.onTouchEnd,!1),window.removeEventListener("ontouchcancel",this.onTouchEnd,!1)},n.zoomIn=function(){(0,this.options.beforeZoomIn)(),this._scrollTop=e(),document.body.classList.add("image-zoom--open"),this._bindEvents(),i()&&this._bindTouchEvents(),this._animateTarget()},n._animateTarget=function(){var t=this;this.isAnimating=!0;var n=this.options,o=n.afterZoomIn,e=n.gutter;this._zoomtarget=this._target.parentNode,this._container=this._target.parentNode.parentNode,this._container.classList.add("open");var i=this._zoomtarget.getBoundingClientRect(),s=i.top,r=i.left,a=i.width,c=i.height,h=this._target,m=h.naturalWidth,d=h.naturalHeight,u=window.innerWidth/2,l=window.innerHeight/2,f=r+a/2,g=s+c/2,v=z({w:a,h:c,nw:m,nh:d,gutter:e}),p=(u-f)/v,b=(l-g)/v;this._zoomtarget.style.width=a+"px",this._zoomtarget.style.height=c+"px",this._zoomtarget.style.transform="scale("+v+") translate3d("+p+"px, "+b+"px, 0)",this._zoomtarget.style.webkitTransform="scale("+v+") translate3d("+p+"px, "+b+"px, 0)",this._zoomtarget.style.MozTransform="scale("+v+") translate3d("+p+"px, "+b+"px, 0)",this._zoomtarget.style.msTransform="scale("+v+") translate3d("+p+"px, "+b+"px, 0)",this._zoomtarget.style.OTransform="scale("+v+") translate3d("+p+"px, "+b+"px, 0)",setTimeout(function(){t.isAnimating=!1},300),o()},n.zoomOut=function(){var t=this,n=this.options,o=n.beforeZoomOut,e=n.afterZoomOut;o(),this._container.classList.remove("open"),document.body.classList.remove("image-zoom--open"),this._zoomtarget.style.transform="none",i()&&this._unbindTouchEvents(),setTimeout(function(){t.isAnimating=!1,t._destroyZoomer()},300),e()},n._bindEvents=function(){this._overlay.addEventListener("click",this.zoomOut,!1),window.addEventListener("scroll",this.onScroll,!1),window.addEventListener("resize",this.onResize,!1)},n._unbindEvents=function(){this._overlay.removeEventListener("click",this.zoomOut,!1),window.removeEventListener("scroll",this.onScroll,!1),window.removeEventListener("resize",this.onResize,!1)},n._destroyZoomer=function(){this._unbindEvents(),this._target=null,this._zoomtarget=null,this._container=null},n.destroy=function(){document.body.classList.remove("image-zoom--open"),document.body.removeChild(this._overlay)},n.onResize=function(){this.isAnimating||this.zoomOut()},n.onScroll=function(){var t=this.options.scrollOffset,n=e();Math.abs(this._scrollTop-n)>t&&(this.isAnimating||this.zoomOut())},n._bindClickDelegateToContainer=function(){this.container.addEventListener("click",this._handleClick,!1)},n._handleClick=function(t){var n=t.target,o=document.body;"IMG"===n.tagName&&(this._target=n,o.classList.contains("image-zoom--open")?this.zoomOut():this.zoomIn())},t}()});
